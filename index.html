<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>axu</title>
    <style>
      * {
        margin: 0;
      }
      body {
        background-color: #eee;
        width: 100vw;
      }
      canvas {
        transition: border-radius 300ms ease-out;
      }
      .circle {
        border-radius: 50%;
        overflow: hidden;
      }
      .colors {
        display: flex;
      }
      .colors span {
        width: 20px;
        height: 20px;
      }
    </style>
  </head>
  <body onload="init()">
    <canvas id="canvas"></canvas>
    <div class="colors">
      <span style="background-color:rgb(255, 255, 255);"></span>
      <span style="background-color:rgb(140, 140, 140);"></span>
      <span style="background-color:rgb(40, 40, 40);"></span>
      <span style="background-color:rgb(255, 40, 40);"></span>
    </div>
    <script>
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');
      // const width = Math.min(window.innerWidth, 1024);
      const width = Math.min(window.innerWidth, 600);
      const r0 = (1 / 20) * width;
      const colors = Array.from(
        document.querySelectorAll('.colors span'),
        node => node.style.backgroundColor
      );
      const r1 = 6 * r0;
      const x1 = width / 2;
      const y1 = width - 2 * r0 - r1;

      const r2 = (2 / 3) * r1;
      const x2 = x1 + r1 / 3;
      const y2 = 2 * r0 + r2;

      const r3 = r2 / 10;
      const x3 = x2 + r2;
      const y3 = y2;

      function init() {
        const loop = [circleToggle, circleToggle, guideLineToggle, main];
        let index = 0;
        canvas.addEventListener('click', () => {
          loop[index](ctx, r0, colors);
          index = index < loop.length - 1 ? index + 1 : 0;
        });

        canvas.width = width;
        canvas.height = width;
        main();
      }

      function circleToggle() {
        ctx.canvas.classList.toggle('circle');
      }

      function guideLineToggle() {
        main();
        guideLine();
      }

      function main() {
        squareBg(colors[0]);
        circle(x1, y1, r1, colors[1]);
        circle(x2, y2, r2, colors[2]);
        circle(x3, y3, r3, colors[3]);
        ctx.strokeStyle = colors[2];
        ctx.lineWidth = 12;
        ctx.beginPath();
        ctx.moveTo(x1, y1 + r2);
        // ctx.lineTo(x1, y1 + r2);
        ctx.lineTo(width, y1 + r2);
        ctx.stroke();
      }

      const gline = (x0, y0, x1, y1) => line(x0, y0, x1, y1, '#75ff9a', 0.5);

      function guideLine() {
        const margin = 2 * r0;
        // top
        gline(0, margin, width, margin);
        // right
        gline(width - margin, 0, width - margin, width);
        // right inner
        gline(width - 2 * margin, 0, width - 2 * margin, width);
        // bottom
        gline(0, width - margin, width, width - margin);
        // left
        gline(margin, 0, margin, width);
        // left inner
        gline(2 * margin, 0, 2 * margin, width);
        // v center
        gline(width / 2, 0, width / 2, width);
        // h center
        gline(0, width / 2, width, width / 2);
        // arc
        ctx.beginPath();
        ctx.arc(width / 2, width / 2, r1, 0, 2 * Math.PI);
        ctx.stroke();
      }

      function squareBg(color) {
        ctx.fillStyle = color;
        ctx.fillRect(0, 0, width, width);
      }

      function circle(x, y, r, color) {
        const c = 2 * Math.PI;
        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.arc(x, y, r, 0, c);
        ctx.closePath();
        ctx.fill();
      }

      function line(x0, y0, x1, y1, color, lineWidth) {
        ctx.strokeStyle = color;
        ctx.lineWidth = lineWidth;
        ctx.beginPath();
        ctx.moveTo(x0, y0);
        ctx.lineTo(x1, y1);
        ctx.stroke();
      }
    </script>
  </body>
</html>
